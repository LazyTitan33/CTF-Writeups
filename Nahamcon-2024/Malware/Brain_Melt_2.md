## Brain Melt 2

![image](https://github.com/LazyTitan33/CTF-Writeups/assets/80063008/c57dd53c-87f6-4a4b-923c-e13adc20049e)

## Enumeration

The challenge file provide is a `.pyc` which is compiled python code. We can use [pycdc](https://github.com/zrax/pycdc) to decompile it and we get this code.

![image](https://github.com/LazyTitan33/CTF-Writeups/assets/80063008/0a0580a1-0f45-4d06-9c40-f09f5ebfa375)

## Solution

It does some crypto shennanigans and deobfuscation but the code requires some cleanup, we remove the parts we don't need and we get it to this state.

```python
# Source Generated with Decompyle++
# File: brain-melt-2.pyc (Python 3.8)

from Crypto.Cipher import Salsa20
import base64

def decrypt1(encoded_string):
    decrypted_string = ''
    for i in range(0, len(encoded_string), 2):
        chunk = str(encoded_string[i:i + 2] + '==')
        decrypted_string += str(base64.b64decode(chunk).decode('ascii'))
    return decrypted_string

def decrypt2(a1, a2):
    result = ''
    for character in a1:
        a2 = 9
        tempcharaddedr = 'temporary value'
        result += chr(((ord(character) - ord('a')) + a2) % 26 + ord('a'))
    return result

def decrypt3(s1, key):
    msg_nonce = s1[:8]
    ciphertext = s1[8:]
    cipher = Salsa20.new(key.encode('utf-8'), nonce=msg_nonce)
    return cipher.decrypt(ciphertext).decode('utf-8')

def deobfuscate():
    part1 = decrypt1('ZgbAYQZwewMAOAZQOQYwYwNQYgMA')
    part2 = decrypt2('fwvcttjsfvrshwsg', 17)
    part3 = decrypt3(b'\x97p#2\x1abw\x0f\x9a\xd1Z\x04b\x93\xa1h8]\xab\xa3\x9e7\xc9\xe8\x9b', '25dbd4f362f7d0e64b24ab231728a1fc')
    key = part1 + part2 + part3
    return key

print(deobfuscate())
```

We run it and get the flag.

`flag{08e9cc5b0ofelccsboeabqfbp3a415bd9a8024930}`
