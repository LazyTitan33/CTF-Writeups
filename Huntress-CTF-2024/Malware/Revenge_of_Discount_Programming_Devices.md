# Revenge of Discount Programming Devices

![image](https://github.com/user-attachments/assets/24f596f6-e372-4252-8ac4-842b0f5138b7)

Download: [challenge](https://raw.githubusercontent.com/LazyTitan33/CTF-Writeups/refs/heads/main/Huntress-CTF-2024/challenge-files/challenge)

## My Solution

Running strings on the binary, we can see it is a python packaged binary:  

![image](https://github.com/user-attachments/assets/2ec7087f-07f6-4f63-ac5f-894696316188)

We can use [pyinstxtractor-ng](https://github.com/pyinstxtractor/pyinstxtractor-ng) to extract it:  

![image](https://github.com/user-attachments/assets/7efceb03-84e1-4fb1-b29c-f45a3f0fd8c7)

We now have a `challenge.pyc` which is still compiled python code:  

![image](https://github.com/user-attachments/assets/17234850-bb6d-4bdb-92ba-c2c4d74cbfaf)

But we can use [pycdc](https://github.com/zrax/pycdc) to decompile this into human readable code:  

![image](https://github.com/user-attachments/assets/8f134063-3edb-4127-b52a-09e337429075)

It is essentially base64 decoding a reversed base64 blob, then decompressing it and executing it. This happens a few times as I've discovered trying to do it manually so I made a short python script where I provided the first base64 blob and ran it.  

```python
#!/usr/bin/python3

import base64, zlib

string = '<base64 blob>'

while True:
    try:
        string = string[::-1]
        decoded_bytes = base64.b64decode(string)
        decompressed_bytes = zlib.decompress(decoded_bytes)        
        string = decompressed_bytes.decode()[11:-3]        
        print(string)
    except Exception as e:
        print(f"Error: {e}")
        break
```

The script eventually stopped and we saw a list of decimals and a comment where it was supposed to print out the result:  

![image](https://github.com/user-attachments/assets/731b1766-05e3-407b-89dc-b8b361bfff18)

I copied that and printed the result:  

![image](https://github.com/user-attachments/assets/cbc416fc-eae7-4940-8a4d-70f3d7fdabe5)

We have yet another script:  

![image](https://github.com/user-attachments/assets/31dcc64d-5a28-4ff1-84e8-b740cd05caca)

I passed it to python to execute it as it was just printing the next stage:  

![image](https://github.com/user-attachments/assets/fd444b15-2b98-4d78-b86a-88d7391ee4b7)

Which surprise surprise, is another base64 blob like at the beginning:  

![image](https://github.com/user-attachments/assets/5f501396-0433-4003-ab6d-0cae26fb461c)

I copied this base64 blob and pasted it into my script and let it rip again until it stopped at this line:  

![image](https://github.com/user-attachments/assets/c90dbacf-51f3-4b59-859c-eafc08968892)

Because of the way I'm cutting up the base64 blob, I got an incomplete flag but it doesn't matter as I have the last base64 line and I can decode it and uncompress it myself:  


```bash
sudo apt install qpdf
echo '==QtSMFZA4STl0DVkzL/FSF3FyB/8fbJNIBvMLqguq1wUt8STN1UzM3M0IqAxIDTORjSIVjML5ENPVzMzkkNvyUSLjkVTxJe'|rev|base64 -d |zlib-flate -uncompress
```

And we get the same result we would using [cyberchef](https://gchq.github.io/CyberChef/#recipe=Reverse('Character')From_Base64('A-Za-z0-9%2B/%3D',true,false)Zlib_Inflate(0,0,'Adaptive',false,false)&input=PT1RdFNNRlpBNFNUbDBEVmt6TC9GU0YzRnlCLzhmYkpOSUJ2TUxxZ3VxMXdVdDhTVE4xVXpNM00wSXFBeElEVE9SalNJVmpNTDVFTlBWek16a2tOdnlVU0xqa1ZUeEpl).

`flag{4f657a3fb50ba3ab42b42f67655599e1}`

